<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ユーザー新規追加画面：入力</title>
  <link type="text/css" rel="stylesheet" href="/stylesheets/account_addition.css">
</head>

<body>
  <h1>解答即時判断システム：ユーザーの新規追加</h1>
  <hr>
  <h2>ユーザーの新規追加</h2>
  <h3>各項目を入力してください。</h3>
  <div id="data"></div>
  <div id="form">
    <div id="text">
      ユーザー名 : <input type="text" id="user_name">
      <p></p>
      <br>学籍番号　 : <input type="text" id="user_ID">
      <p></p>
      <br>パスワード : <input type="password" id="password">
      <p></p>
      <br>確認　　　 : <input type="password" id="confirmationText">
      <p></p>
      <br>教師権限 : <input type="checkbox" id="user_type">
    </div>
    <p></p>
    <p></p>
    <div id="button">
      <input type="button" value="戻る" id="submit" onclick="location.href='account_additionMethod'">
      <input type="button" value="追加" id="addUserButton">
    </div>
  </div>

  <script>
    document.getElementById("addUserButton").addEventListener("click", function() {
      // フォームから入力された値を取得
      var user_ID = document.getElementById("user_ID").value;
      var user_name = document.getElementById("user_name").value;
      var password = document.getElementById("password").value;
      var user_type = document.getElementById("user_type").checked ? 1 : 2; // チェックが入っていれば1、そうでなければ2

      // 現在の日時と時間を取得
      var currentDate = new Date();
      var formattedDate = currentDate.toLocaleString(); // ローカルの日時を文字列に変換

      // テキストファイルに日時を保存
      var textToSave = "Clicked on: " + log_time;
      var blob = new Blob([textToSave], { type: "text/plain;charset=utf-8" });
      saveAs(blob, "click_log.txt");

      // データベースへの書き込み処理を行う関数を呼び出す
      writeToDatabase(user_ID, user_name, password, log_time, user_type);
    });

    const mysql = require('mysql');

    //接続情報の設定
    const connection = mysql.createConnection({
      host: 'localhost',
      user: 'root',
      password: 'matosui122083',
      database: 'mysql'
    });

    //データベースへの接続
    connection.connect((err) => {
      if (err) throw err;
      console.log('データベースに接続しました。');
    });

    function writeToDatabase(user_ID, user_name, password, log_time, user_type) {
      const user = {user_ID: userID, user_name: user_name, password: password, log_time: log_time, user_type: user_type};

      const query = connection.query('INSERT INTO user_table SET ?', user, (err, result) => {
        if (err) throw err;
        console.log('データが挿入されました。');
      });
    }
  </script>
</body>
</html>